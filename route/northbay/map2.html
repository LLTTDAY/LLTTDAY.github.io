<html><head>
    <title>Route Map</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/2.1.1/mapbox-gl.js"></script>
	<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/2.1.1/mapbox-gl.css">

    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">

        // Get your own API Key on https://myprojects.geoapify.com
        mapboxgl.accessToken = "pk.eyJ1IjoibGx0dGRheSIsImEiOiJja2RrbGhwazUwY2EzMnl0MnFxdXI1MnI5In0.3mcdJCpgz-15EqRGGnxEoA";

        var map = new mapboxgl.Map({
            container: 'map',
            style: `mapbox://styles/llttday/ckmb2idf39c2017tfyrsfoyyk`,
        });
        map.on('load', function () {
            map.addSource('routes', {
            	type: 'geojson',
				data: 'route.geojson'
            });
            map.addLayer({
            'id': 'routes',
			'type': 'line',
			'source': 'routes',
			'layout': {
			'line-join': 'round',
			'line-cap': 'round'
			},
			'paint': {
			'line-color': '#4657t3',
			'line-width': 8
			}
			})
		});
        map.on('load', function () {
			  var animationDuration = 80000;
			  var cameraAltitude = 4000;
			  // this is the path the camera will look at
        var targetRoute = map.getLayer('routes');
        // this is the path camera will move along
        var cameraRoute = map.getLayer('routes');
			// get the overall distance of each route so we can interpolate along them
			var routeDistance = turf.lineDistance(turf.lineString(targetRoute));
			var cameraRouteDistance = turf.lineDistance(
			turf.lineString(cameraRoute)
			);
			 
			var start;
			 
			function frame(time) {
			if (!start) start = time;
			// phase determines how far through the animation we are
			var phase = (time - start) / animationDuration;
			 
			// phase is normalized between 0 and 1
			// when the animation is finished, reset start to loop the animation
			if (phase > 1) {
			// wait 1.5 seconds before looping
			setTimeout(function () {
			start = 0.0;
			}, 1500);
			}
			
			// use the phase to get a point that is the appropriate distance along the route
			// this approach syncs the camera and route positions ensuring they move
			// at roughly equal rates even if they don't contain the same number of points
			var alongRoute = turf.along(
			turf.lineString(targetRoute),
			routeDistance * phase
			).geometry.coordinates;
			 
			var alongCamera = turf.along(
			turf.lineString(cameraRoute),
			cameraRouteDistance * phase
			).geometry.coordinates;
			 
			var camera = map.getFreeCameraOptions();
			 
			// set the position and altitude of the camera
			camera.position = mapboxgl.MercatorCoordinate.fromLngLat(
			{
			lng: alongCamera[0],
			lat: alongCamera[1]
			},
			cameraAltitude
			);
			 
			// tell the camera to look at a point along the route
			camera.lookAtPoint({
			lng: alongRoute[0],
			lat: alongRoute[1]
			});
			 
			map.setFreeCameraOptions(camera);
			 
			window.requestAnimationFrame(frame);
			}
			 
			window.requestAnimationFrame(frame);
			});
    </script>
</body></html>